ALTER TABLE "product_images" RENAME COLUMN "image_url" TO "url";--> statement-breakpoint
ALTER TABLE "product_images" RENAME COLUMN "alt_text" TO "alt";--> statement-breakpoint
CREATE VIEW "public"."products_view" AS (select "products"."id", "products"."name", MIN("product_images"."url") as "image_url", "products"."price", SUM("product_variants"."stock") as "stock", MIN("product_variants"."extra_price") as "min_price", MAX("product_variants"."extra_price") as "max_price", AVG("product_reviews"."rating") as "average_rating" from "products" inner join "product_images" on "products"."id" = "product_images"."product_id" inner join "product_variant_groups" on "products"."id" = "product_variant_groups"."product_id" inner join "product_variants" on "product_variant_groups"."id" = "product_variants"."variant_group_id" inner join "product_reviews" on "products"."id" = "product_reviews"."product_id" where "products"."status" = 'active' group by "products"."id", "products"."name", "products"."price");